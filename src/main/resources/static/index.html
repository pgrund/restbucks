<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <title>RESTBucks - RESTful Coffee Ordering</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta name="description" content="information about single RESTBucks order"/>
        <meta name="author" content="RESTBucks system"/>

        <!-- HTML5 shim, for IE6-8 support of HTML elements -->
        <!--[if lt IE 9]>
          <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <!-- styles -->
        <link href="/css/bootstrap.css" rel="stylesheet"/>
        <style type="text/css">
            body {
                padding-top: 60px;
                padding-bottom: 40px;
            }
            .sidebar-nav {
                padding: 9px 0;
            }
        </style>
        <link href="/css/bootstrap-responsive.css" rel="stylesheet"/>

        <!-- fav and touch icons 
        <link rel="shortcut icon" href="./images/favicon.ico"/>
        <link rel="apple-touch-icon" href="./images/apple-touch-icon.png"/>
        <link rel="apple-touch-icon" sizes="72x72" href="./images/apple-touch-icon-72x72.png"/>
        <link rel="apple-touch-icon" sizes="114x114" href="./images/apple-touch-icon-114x114.png"/>
        -->
        <script type="text/javascript">

            function messagebox(heading, text, mode) {
                mode = typeof mode !== 'undefined' ? mode : 'error';
                $("#messagebox").html('<div class="alert alert-' + mode + ' alert-dismissable">' +
                        '<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>' +
                        '<h2 class="alert-heading">' + heading + '</h2>' +
                        '<p class="alert-block">' + text + '</p>');
            }
            function nameTmpl(idx, value) {
                return value === undefined ? '' : '<div class="control-group"> ' +
                        '<label class="control-label" for="' + idx + '-name">Name</label>' +
                        '<div class="controls">' +
                        '<select id="' + idx + '-name" name="' + idx + '-name"> ' +
                        '<option value="ESPRESSO"' + (value === 'ESPRESSO' ? ' selected' : '') + '>espresso</option>' +
                        '<option value="LATTE"' + (value === 'LATTE' ? ' selected' : '') + '>latte</option> ' +
                        '<option value="CAPUCCINO"' + (value === 'CAPUCCINO' ? ' selected' : '') + '>capuccino</option>' +
                        '<option value="FLAT_WHITE"' + (value === 'FLAT_WHITE' ? ' selected' : '') + '>flat white</option> ' +
                        '</select> ' +
                        '</div>' +
                        '</div>';
            }
            function quantityTmpl(idx, value) {
                return value === undefined ? '' : '<div class="control-group">' +
                        '<label class="control-label" for="' + idx + '-quantity">Quantity</label>' +
                        '<div class="controls">' +
                        '<input type="number" min="1" id="' + idx + '-quantity" name="' + idx + '-quantity" value="' + value + '" size="4"/>' +
                        '</div>' +
                        '</div> ';
            }
            function milkTmpl(idx, value) {
                return value === undefined ? '' : '<div class="control-group">' +
                        '<label class="control-label" for="' + idx + '-milk">Milk</label>' +
                        '<div class="controls">' +
                        '<select id="' + idx + '-milk" name="' + idx + '-milk">' +
                        '<option value="SEMI"' + (value === 'SEMI' ? ' selected' : '') + '>semi milk</option> ' +
                        '<option value="SKIM"' + (value === 'SKIM' ? ' selected' : '') + '>skim milk</option> ' +
                        '<option value="WHOLE"' + (value === 'WHOLE' ? ' selected' : '') + '>whole milk</option> ' +
                        '</select>' +
                        '</div>'
                '</div> ';
            }
            function sizeTmpl(idx, value) {
                return value === undefined ? '' : '<div class="control-group">' +
                        '<label class="control-label" for="' + idx + '-size">Size</label>' +
                        '<div class="controls">' +
                        '<select id="' + idx + '-size" name="' + idx + '-size">' +
                        '<option value="SMALL"' + (value === 'SMALL' ? ' selected' : '') + '>small</option> ' +
                        '<option value="MEDIUM"' + (value === 'MEDIUM' ? ' selected' : '') + '>medium</option>' +
                        '<option value="LARGE"' + (value === 'LARGE' ? ' selected' : '') + '>large</option>' +
                        '</select>' +
                        '</div>' +
                        '</div>';
            }
            function shotTmpl(idx, value) {
                return value === undefined ? '' : '<div class="control-group">' +
                        '<label class="control-label" for="' + idx + '-shot">Shot</label>' +
                        '<div class="controls">' +
                        '<select id="' + idx + '-shot" name="' + idx + '-size">' +
                        '<option value="SINGLE"' + (value === 'SINGLE' ? ' selected' : '') + '>single</option> ' +
                        '<option value="DOUBLE"' + (value === 'DOUBLE' ? ' selected' : '') + '>double</option>' +
                        '<option value="TRIPLE"' + (value === 'TRIPLE' ? ' selected' : '') + '>triple</option>' +
                        '</select>' +
                        '</div>' +
                        '</div>';
            }

            function linkNavTmpl(origRel) {
                rel = origRel.split(':').pop();
                var icons = {};
                icons['self'] = 'icon-refresh';
                icons['update'] = 'icon-pencil';
                icons['cancel'] = 'icon-trash';
                icons['pay'] = 'icon-shopping-cart';
               
                return '<li class="' + (rel === 'self' ? 'active' : '') + '">' +
                        '<a href="#' + rel + '" data-toggle="tab" onclick="' + (rel === 'cancel' ? 
                'messagebox(\'Warning!\', \'Are you sure you want to cancel/delete this order ?\')' : 
                '$(\'#messagebox div.alert\').alert(\'close\')') + 
                        '">' +
                        '<i class="' + icons['' + rel] + '"></i>' +
                        '<span>' + rel + '</span>' +
                        '</a>' +
                        '</li>'
            }
            function linkTabTmpl(origRel, obj, status) {
                var rel = origRel.split(':').pop();
                if (rel === 'self') {
                    
                            '<p';
                    if (status === 'UNPAID') {
                        $("#self p.status").val('Your order is awaiting payment. <br/> You may also <a href="#cancel" data-toggle="tab">cancel</a> your order completely.</p>');
                    } else {
                        $("#self p.status").addClass("alert").val(status);
                    }
                }

                $('#send'+rel).data('href', (rel === 'curies' ? obj : obj.href));
                
            }

            function cancel(url) {
                console.log('cancel for '+ url);
                return;
                $.ajax({
                    url: url,
                    type: 'DELETE',
                    context: document.getElementById("cancel")
                }).done(function () {
                    $("#alert\\.cancel").text("resource deleted, page update in 5 sec ..").addClass("alert-success");
                    window.setTimeout(function () {
                        self(url);
                    }, 5000);
                });

            }
            function pay(url) {
                console.log('pay for '+ url);
                return;
            }
            function update(url) {
                console.log('update for '+ url);
                return;
            }

            function self(url) {
                $.getJSON(url, function (order) {
                    selectedOrder = order;

                    $('#orderid').text(": " + order.id);
                    $("input[name=location][value=" + order.location + "]").prop('checked', true);

                    $('#items').empty();
                    order.items.forEach(function (item, idx) {
                        $('#items').append(quantityTmpl(idx, item.quantity));
                        $('#items').append(nameTmpl(idx, item.name));
                        $('#items').append(milkTmpl(idx, item.milk));
                        $('#items').append(sizeTmpl(idx, item.size));
                        $('#items').append(shotTmpl(idx, item.shots));
                    });

                    $('#links ul.nav-tabs').empty();
                    $.each(order._links, (function (rel, href) {
                        $('#links ul.nav-tabs').append(linkNavTmpl(rel));
                        linkTabTmpl(rel, href, order.status);
                    }));
                });
            }
            
            function curies(url) {
                console.log('curies, got infos at ...', url);
                return;
            }

        </script>
    </head>

    <body>
        <div class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="#">RESTBucks</a>
                    <div class="nav-collapse">
                        <ul class="nav">
                            <li>
                                <a href="/restbucks.html#">Info</a>
                            </li>
                            <li>
                                <a href="/restbucks.html#model">Model</a>
                            </li>
                            <li>
                                <a href="/restbucks.html#hypermedia">Hypermedia</a>
                            </li>
                        </ul>
                        <p class="navbar-text pull-right">Logged in as <a href="#">username</a></p>
                    </div><!--/.nav-collapse -->
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div id="messagebox"></div>

            <div class="row-fluid" id="order">
                <div class="span2">
                    <div class="well sidebar-nav">
                        <ul class="nav nav-list">
                            <li class="nav-header">RESTBucks</li>                                    
                            <li class="nav-header">
                                <a href="https://github.com/pgrund/restbucks">source</a>
                            </li>
                        </ul>
                    </div><!--/.well -->
                </div><!--/span-->
                <div class="span10">
                    <div class="hero-unit">
                        <h3>RESTBucks Order <span id="orderid"></span></h3>
                        <form id="updateOrder" class="form-horizontal" role="form">
                            <div class="control-group">
                                <div class="control-group">
                                    <label class="col-sm-4 control-label">Location</label>
                                    <label class="radio-inline"> <input type="radio" name="location" value="IN_SHOP"> in shop </label>
                                    <label class="radio-inline"> <input type="radio" name="location" value="TAKE_AWAY"> take away </label>
                                </div>
                            </div>
                            <fieldset>
                                <legend>Items</legend>
                                <div id="items"></div>
                            </fieldset>
                        </form>
                        <div class="row-fluid tabbable" id="links">
                            <ul class="nav nav-tabs"></ul>
                            <div class="tab-content">
                                <div id="self" class="tab-pane active">
                                    <p class="status"></p>
                                    <button id="sendself" onclick="self($(this).data('href'))" class="btn btn-success">refresh</button>
                                </div>
                                <div id="update" class="tab-pane">
                                    <p>Please be aware that all data of the order will be <strong>OVERWRITTEN</strong>.</p>
                                    <button id="sendupdate" onclick="update($(this).data('href'))" class="btn btn-success">update order</button>
                                </div>
                                <div id="cancel" class="tab-pane">
                                    <p>Cancelling this order will not delete it immediately, status get changed and cleanup will be done later.</p>
                                    <button id="sendcancel" onclick="cancel($(this).data('href'))" class="btn btn-success">cancel order</button>
                                </div>
                                <div id="pay" class="tab-pane">
                                    <p>...</p>
                                    <button id="sendpay" onclick="pay($(this).data('href'))" class="btn btn-success">pay for order</button>
                                </div>
                                <div id="curies" class="tab-pane">
                                    <p>infos for all relations mentioned ... </p>
                                    <button id="sendcuries" onclick="curies($(this).data('href'))" class="btn btn-success">view relation infos</button>
                                </div>
                            </div>
                        </div><!--/row-->
                    </div><!--/span-->
                </div>

            </div><!--/row-->
        </div><!--/container-->

        <!-- Le javascript
        ================================================== -->
        <!-- Placed at the end of the document so the pages load faster -->
        <script src="/js/jquery.js"></script>
        <script src="/js/bootstrap-transition.js"></script>
        <script src="/js/bootstrap-alert.js"></script>
        <script src="/js/bootstrap-modal.js"></script>
        <script src="/js/bootstrap-dropdown.js"></script>
        <script src="/js/bootstrap-scrollspy.js"></script>
        <script src="/js/bootstrap-tab.js"></script>
        <script src="/js/bootstrap-tooltip.js"></script>
        <script src="/js/bootstrap-popover.js"></script>
        <script src="/js/bootstrap-button.js"></script>
        <script src="/js/bootstrap-collapse.js"></script>
        <script src="/js/bootstrap-carousel.js"></script>
        <script src="/js/bootstrap-typeahead.js"></script>
        <script type="text/javascript">
            $(document).ajaxError(function (event, jqXHR, settings, errorThrown) {
                rbError = $.parseJSON(jqXHR.responseText);
                messagebox(errorThrown, rbError.path + ': ' + rbError.message);
            });
            $(function () {
                var selfUrl = window.location.href;
                if (selfUrl.search("/orders/") > 0) {
                    self(selfUrl);
                } else {
                    messagebox('Invalid call','no order can be displayed, mismatched URL');
                }
            });
        </script>
    </body>
</html>
