<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <title>RESTBucks - RESTful Coffee Ordering</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="information about single RESTBucks order"/>
        <meta name="author" content="RESTBucks system"/>

        <!-- HTML5 shim, for IE6-8 support of HTML elements -->
        <!--[if lt IE 9]>
          <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <!-- styles -->
        <link href="/css/bootstrap.min.css" rel="stylesheet"/>
        <style type="text/css">
            body {
                padding-top: 60px;
                padding-bottom: 40px;
            }
            .sidebar-nav {
                padding: 9px 0;
            }

            h2.alert-heading {
                color:whitesmoke;
                text-shadow: 2px 2px 3px black;
                padding: 10px;
            }
            .alert-danger >  h2.alert-heading {
                background-color: rgb(169,68,66);
            }
            .alert-info >  h2.alert-heading {
                background-color: rgb(49,112,143);
            }
            .alert-success >  h2.alert-heading {
                background-color: rgb(65,118,61);
            }

        </style>
        <link href="/css/bootstrap-responsive.css" rel="stylesheet"/>

        <script type="text/javascript">


            function messagebox(heading, text, mode) {
                var signs = [];
                signs['danger'] = "glyphicon-warning-sign";
                signs['info'] = "glyphicon-info-sign";
                signs['success'] = "glyphicon glyphicon-ok-sign";
                mode = typeof mode !== 'undefined' ? mode : 'danger';
                var icon = typeof signs[mode] !== 'undefined' ? signs[mode] : "glyphicon-warning-sign";
                $("#messagebox").html('<div class="alert alert-' + mode + ' alert-dismissable" role="alert">' +
                        '<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>' +
                        '<h2 class="alert-heading">' +
                        '<span class="span1 glyphicon ' + icon + '"></span>' + heading + '</h2>' +
                        '<p class="alert-block">' + text + '</p></div>');
                return $('#messagebox');
            }

            function newItem(idx) {
                var nextIdx = (idx === undefined ? $('#items .item').length : idx)
                var newItem = $($('#items .item')[0]).clone(true);

                // rename id and name of new child elements, assign default values
                newItem.find("#0_quantity").attr({id: nextIdx + '_quantity', name: 'items[' + nextIdx + '].quantity', value: '0'});
                newItem.find("#0_name").attr({id: nextIdx + '_name', name: 'items[' + nextIdx + '].name', value: ''});
                newItem.find("#0_milk").attr({id: nextIdx + '_milk', name: 'items[' + nextIdx + '].milk', value: ''});
                newItem.find("#0_size").attr({id: nextIdx + '_size', name: 'items[' + nextIdx + '].size', value: 'MEDIUM'});
                newItem.find("#0_shots").attr({id: nextIdx + '_shots', name: 'items[' + nextIdx + '].shots', value: 'SINGLE'});

                $("#items").append(newItem);

                return false;
            }
            
            function payment(url) {
                console.log('pay for ' + url);
                return;
            }

           function curies(url) {
                console.log('curies, got infos at ...', url);
                return;
            }

        </script>
        <script src="/js/self.js" type="text/javascript"></script>
    </head>

    <body>
        <nav class="navbar navbar-fixed-top navbar-inverse">            
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1" aria-expanded="false">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">RESTBucks</a>
                </div>
                <div class="nav-collapse" id="navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li>
                            <a href="/restbucks.html#">Info</a>
                        </li>
                        <li>
                            <a href="/restbucks.html#model">Model</a>
                        </li>
                        <li>
                            <a href="/restbucks.html#hypermedia">Hypermedia</a>
                        </li>
                    </ul>
                    <p class="navbar-text pull-right">Logged in as <a href="#">username</a></p>
                </div><!--/.nav-collapse -->
            </div>
        </nav>
        <div class="container-fluid">

            <div id="messagebox"></div>

            <div class="row-fluid" id="order">
                <div class="span2">
                    <div class="well">
                        <ul class="nav nav-pills">
                            <li class="navbar-brand">RESTBucks</li>      
                            <li class="divider" role="seperator"></li>
                            <li>
                                <a href="/">new order</a>
                            </li>
                            <li class="divider" role="seperator"></li>
                            <li class="nav-header">
                                <a href="https://github.com/pgrund/restbucks">source</a>
                            </li>
                        </ul>
                    </div><!--/.well -->
                </div><!--/span-->
                <div class="span10">
                    <div class="jumbotron" id="order">
                        <h2>RESTBucks Order <span id="orderid"></span></h2>
                        <form class="form-horizontal" role="form">
                            <div class="form-group">
                                <label class="col-sm-2 control-label">Location</label>
                                <label class="radio-inline"> 
                                    <input type="radio" name="location" value="IN_SHOP" required="required"> in shop 
                                </label>
                                <label class="radio-inline"> 
                                    <input type="radio" name="location" value="TAKE_AWAY" required="required"> take away 
                                </label>
                            </div>
                            <fieldset class="items">
                                <legend>Items</legend>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="items[0].quantity">Quantity</label>
                                    <div class="col-sm-2">
                                        <input type="number" class="form-control" min="1" name="items[0].quantity" id="0_quantity" value="1" required="required"/>
                                    </div>
                                </div> 
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="items[0].name">Name</label>
                                    <div class="col-sm-3">
                                        <select name="items[0].name" id="0_name" class="form-control" required="required">
                                            <option value="CAPPUCCINO" selected="selected">Cappuccino</option>
                                            <option value="LATTE">Latte</option>
                                            <option value="ESPRESSO">Espresso</option>
                                            <option value="FLAT_WHITE">Flat White</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="items[0].milk">Milk</label>
                                    <div class="col-sm-3">
                                        <select name="items[0].milk" id="0_milk" class="form-control">
                                            <option value="SEMI" selected="selected">semi milk</option>
                                            <option value="SKIM">skim milk</option>
                                            <option value="WHOLE">whole milk</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="items[0].size">Size</label>
                                    <div class="col-sm-3">
                                        <select name="items[0].size" id="0_size" class="form-control">
                                            <option value="SMALL">small</option>
                                            <option value="MEDIUM" selected="selected">medium</option>
                                            <option value="LARGE">large</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="items[0].shots">Shot</label>
                                    <div class="col-sm-3">
                                        <select name="items[0].shots" id="0_shots" class="form-control">
                                            <option value="SINGLE" selected="selected">
                                            <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                                            single
                                            </option>
                                            <option value="DOUBLE">double</option>
                                            <option value="TRIPLE">triple</option>
                                        </select>
                                    </div>
                                </div>

                            </fieldset>
                        </form>                    
                        <button id="addItem" onclick="newItem()">add another item</button>
                        <div class="row-fluid tabbable links" id="links">
                            <ul class="nav nav-tabs">
                                <li id="link_self" class="active">
                                    <a href="#self" data-toggle="tab">
                                        <i icon="icon-refresh"></i>
                                        <span>self</span>
                                    </a>
                                </li>                              
                                <li id="link_payment">
                                    <a href="#payment" data-toggle="tab">
                                        <i icon="icon-shopping-cart"></i>
                                        <span>pay order</span>
                                    </a>
                                </li>
                            </ul>
                            <div class="tab-content">
                                <div id="self" class="tab-pane active">
                                    <p class="status self">
                                        Your order is awaiting payment. <br/> 
                                        You may also <a href="#cancel" data-toggle="tab">cancel</a> your order completely.
                                    </p>
                                    <div id="update" class="status unpaid">
                                        <button onclick="update($(this))" class="col-md-2 btn btn-success">update order</button>
                                        <p class="col-md-10">Please be aware that all data of the order will be <strong>OVERWRITTEN</strong>.</p>                                        
                                    </div>
                                    <div id="cancel" class="status unpaid">
                                        <button onclick="cancel($(this))" class="col-md-2 btn btn-success">cancel order</button>
                                        <p class="col-md-10">Cancelling this order will not delete it immediately, status get changed and cleanup will be done later.</p>
                                    </div>
                                    <div id="create" class="status new">
                                        <button onclick="create($(this))" data-href="/orders" class="col-md-2 btn btn-success">create order</button>                                        
                                    </div>
                                    <!--button id="sendself" onclick="self($(this).data('href'))" class="btn btn-success">refresh</button-->
                                </div>                            
                                <div id="payment" class="tab-pane">
                                    <p>...</p>
                                    <button id="sendpayment" onclick="pay($(this).data('href'))" class="btn btn-success">pay for order</button>
                                </div>
                                <div id="curies" class="tab-pane">
                                    <p>infos for all relations mentioned ... </p>
                                    <button id="sendcuries" onclick="curies($(this).data('href'))" class="btn btn-success">view relation infos</button>
                                </div>
                            </div>
                        </div><!--/row-->
                    </div><!--/span-->
                </div>
            </div><!--/row-->
        </div><!--/container-->

        <!-- Placed at the end of the document so the pages load faster -->
        <script src="/js/jquery-2.2.4.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        <script type="text/javascript">
                                        $(document).ajaxError(function (event, jqXHR, settings, errorThrown) {
                                            console.log(jqXHR.responseText),
                                                    rbError = $.parseJSON(jqXHR.responseText);
                                            messagebox(errorThrown, rbError.path + ': ' + rbError.message);
                                        });
                                        $(function () {
                                            var selfUrl = window.location.href.slice(0, -5);
                                            if (selfUrl.search("/orders/") > 0) {
                                                self(selfUrl, $(".jumbotron"));                                               
                                            } else {
                                                messagebox('New Order', '', "info");                                        
                                                updateHTML(selectedOrder, $('#order'));
                                               
                                            }                                            
                                        });
        </script>
    </body>
</html>