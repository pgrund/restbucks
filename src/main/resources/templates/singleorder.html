<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
    <head>
        <meta charset="utf-8"/>
        <title>RESTBucks - RESTful Coffee Ordering</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta name="description" content="information about single RESTBucks order"/>
        <meta name="author" content="RESTBucks system"/>

        <!-- HTML5 shim, for IE6-8 support of HTML elements -->
        <!--[if lt IE 9]>
          <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <!-- styles -->
        <link href="../static/css/bootstrap.css" th:href="@{/css/bootstrap.css}" rel="stylesheet"/>
        <style type="text/css">
            body {
                padding-top: 60px;
                padding-bottom: 40px;
            }
            .sidebar-nav {
                padding: 9px 0;
            }
        </style>
        <link href="/static/css/bootstrap-responsive.css" th:href="@{/css/bootstrap-responsive.css}" rel="stylesheet"/>

        <!-- fav and touch icons 
        <link rel="shortcut icon" href="/static/images/favicon.ico"/>
        <link rel="apple-touch-icon" href="/static/images/apple-touch-icon.png"/>
        <link rel="apple-touch-icon" sizes="72x72" href="/static/images/apple-touch-icon-72x72.png"/>
        <link rel="apple-touch-icon" sizes="114x114" href="/static/images/apple-touch-icon-114x114.png"/>
        -->
    </head>

    <body>
        <div class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="#">RESTBucks</a>
                    <div class="nav-collapse">
                        <ul class="nav">
                            <li>
                                <a href="/static/restbucks.html#" th:href="@{/restbucks.html#}">Info</a>
                            </li>
                            <li>
                                <a href="/static/restbucks.html#model" th:href="@{/restbucks.html#model}">Model</a>
                            </li>
                            <li>
                                <a href="/static/restbucks.html#hypermedia" th:href="@{/restbucks.html#hypermedia}">Hypermedia</a>
                            </li>
                        </ul>
                        <p class="navbar-text pull-right">Logged in as <a href="#">username</a></p>
                    </div><!--/.nav-collapse -->
                </div>
            </div>
        </div>

        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span2">
                    <div class="well sidebar-nav">
                        <ul class="nav nav-list">
                            <li class="nav-header">RESTBucks</li>                                    
                            <li class="nav-header">
                                <a href="https://github.com/pgrund/restbucks">source</a>
                            </li>
                        </ul>
                    </div><!--/.well -->
                </div><!--/span-->
                <div class="span10">
                    <div class="hero-unit">
                        <h3 th:utext='|RESTBucks Order (id:${order.id})|'>RESTBucks Order</h3>
                        <form action="{./dap:link[@title='update']/@href}" method="post" 
                              id="updateOrder" class="form-horizontal">
                            <fieldset>
                                <legend>Items</legend>
                                <div th:each="item : ${order.items}" >
                                    <div class="control-group">
                                        <label class="control-label" for="name">Name</label>
                                        <div class="controls">
                                            <select id="name" name="name">                      
                                                <option value="ESPRESSO" th:attr="selected=${item.name.isEspresso()}">
                                                    espresso
                                                </option> 
                                                <option value="LATTE" th:attr="selected=${item.name.isLatte()}">
                                                    latte
                                                </option>
                                                <option value="CAPUCCINO" th:attr="selected=${item.name.isCappuccino()}">
                                                    capuccino
                                                </option>
                                                <option value="FLAT_WHITE" th:attr="selected=${item.name.isFlatWhite()}">
                                                    flat white
                                                </option>
                                            </select>
                                        </div>
                                    </div>         

                                    <div class="control-group">
                                        <label class="control-label" for="quantity">Quantity</label>
                                        <div class="controls">
                                            <input type="number" min="1" id="quantity" name="quantity" th:attr="value=${item.quantity}" value="0"/>
                                        </div>
                                    </div> 

                                    <div class="control-group">
                                        <label class="control-label" for="milk">Milk</label>
                                        <div class="controls">
                                            <select id="milk" name="milk">
                                                <option value="SEMI" th:attr="selected=${item.milk.isSemi()}">
                                                    semi milk
                                                </option> 
                                                <option value="SKIM" th:attr="selected=${item.milk.isSkim()}">
                                                    skim milk
                                                </option>                         
                                                <option value="WHOLE" th:attr="selected=${item.milk.isWhole()}">
                                                    whole milk
                                                </option> 
                                            </select>
                                        </div>
                                    </div>  

                                    <div class="control-group">
                                        <label class="control-label" for="size">Size</label>
                                        <div class="controls">
                                            <select id="size" name="size">
                                                <option value="SMALL" th:attr="selected=${item.size.isSmall()}">
                                                    small
                                                </option> 
                                                <option value="MEDIUM" th:attr="selected=${item.size.isMedium()}">
                                                    medium
                                                </option>
                                                <option value="LARGE" th:attr="selected=${item.size.isLarge()}">
                                                    large
                                                </option>
                                            </select>
                                        </div>
                                    </div>

                                </div>
                            </fieldset>

                            <div class="control-group">
                                <label class="control-label" for="location">Location</label>
                                <div class="controls">
                                    <select id="location" name="location">
                                        <option value="TAKE_AWAY" th:attr="selected=${order.location.isTakeAway()}">
                                            take away
                                        </option> 
                                        <option value="IN_SHOP" th:attr="selected=${order.location.isInShop()}">
                                            in shop
                                        </option> 
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-success">update</button>
                        </form>
                    </div>
                    <div class="row-fluid tabbable">
                        <ul class="nav nav-tabs">
                            <th:block th:each="link : ${links}">
                            <li class="active" th:attr="class=((${link.getRel()} == 'self') ? 'active')">
                                <a href="#self" th:href="'#'+${link.getRel()}" data-toggle="tab">
                                    <i th:attr="class='icon-' +((${link.getRel()} == 'update') ? 'pencil' : ((${link.getRel()} == 'cancel') ? 'trash' : ((${link.getRel()} == 'pay') ? 'shopping-cart' : 'refresh' )))" class="icon-trash"></i>
                                    <span th:text="${link.getRel()}">self</span>
                                </a>
                            </li>
                            </th:block>
                        </ul>
                        <div class="tab-content">
                                 <div th:each="link : ${links}" id="self" class="tab-pane active" th:attr="id=${link.getRel()},class='tab-pane' + ((${link.getRel()} == 'self' ? ' active' : ''))">
                               
                                
                                    <div th:if="${link.getRel()} == 'self'" class="order" th:switch="${order.getStatus().toString()}">
                                        <p class="status" th:case="UNPAID">Your order is awaiting payment. <br/> You may also <a href="#cancel" data-toggle="tab">cancel</a> your order completely.</p>

                                        <p class="alert" th:case="*" th:text="${order.getStatus().toString()}">status</p>
                                    </div>
                                     <th:block th:if="${link.getRel()} == 'cancel'" >
                                    <div class="alert" id="alert.cancel">
                                        <button type="button" class="close" data-dismiss="alert">x</button>
                                        <strong>Warning!</strong> Are you sure you want to cancel/delete this order ?
                                    </div>                     
                                    <script type="text/javascript" th:inline="javascript">
                                        function deleteOrder() {
                                            $.ajax({
                                                url: [[${link.getHref()}]],
                                                type: 'DELETE',
                                                context: document.getElementById("cancel")
                                            }).done(function () {
                                                console.log('done');
                                                $("#alert.cancel").text("resource deleted").addClass("alert-success");
                                            }).fail(function (jqXHR, textStatus, errorThrown) {
                                                console.log('failed');
                                                $("#alert.cancel").text(textStatus).addClass("alert-error").prepend('<button type="button" class="close" data-dismiss="alert">x</button><strong>Error!</strong> ');
                                            });
                                        }
                                    </script>
                                    <button class="btn" type="button" onclick="deleteOrder();">cancel order</button>
                                    
                                     </th:block>
                                    <button th:if="${link.getRel()} != 'cancel'" id="send" onclick="self();" th:attr="onclick=${link.getRel()}+'()'" class="btn btn-success" th:text="${link.getRel()}">
                                        self
                                    </button>         
                                </div>
                            
                        </div>
                        </div><!--/row-->
                    </div><!--/span-->
                </div><!--/row-->
            </div><!--/container-->

            <!-- Le javascript
            ================================================== -->
            <!-- Placed at the end of the document so the pages load faster -->
            <script src="/static/js/jquery.js" th:src="@{/js/jquery.js}"></script>
            <script src="/static/js/bootstrap-transition.js" th:src="@{/js/bootstrap-transition.js}"></script>
            <script src="/static/js/bootstrap-alert.js" th:src="@{/js/bootstrap-alert.js}"></script>
            <script src="/static/js/bootstrap-modal.js" th:src="@{/js/bootstrap-modal.js}"></script>
            <script src="/static/js/bootstrap-dropdown.js" th:src="@{/js/bootstrap-dropdown.js}"></script>
            <script src="/static/js/bootstrap-scrollspy.js" th:src="@{/js/bootstrap-scrollspy.js}"></script>
            <script src="/static/js/bootstrap-tab.js" th:src="@{/js/bootstrap-tab.js}"></script>
            <script src="/static/js/bootstrap-tooltip.js" th:src="@{/js/bootstrap-tooltip.js}"></script>
            <script src="/static/js/bootstrap-popover.js" th:src="@{/js/bootstrap-popover.js}"></script>
            <script src="/static/js/bootstrap-button.js" th:src="@{/js/bootstrap-button.js}"></script>
            <script src="/static/js/bootstrap-collapse.js" th:src="@{/js/bootstrap-collapse.js}"></script>
            <script src="/static/js/bootstrap-carousel.js" th:src="@{/js/bootstrap-carousel.js}"></script>
            <script src="/static/js/bootstrap-typeahead.js" th:src="@{/js/bootstrap-typeahead.js}"></script>

    </body>
</html>
